{% extends "base.html" %}
{% block title %} Iniciar Sesión {% endblock%}

{% block css %}
<link rel="stylesheet" href="{{base_url()}}/{{ asset('static/css/login.css') }}">
{% endblock %}

{% block content %}
<div class="back">
  <div class="container">
    <div class="row">
      <div class="col-12 mt-5 mb-5">
        <h1 class="text-white">
          IG CONSULTORES
        </h1>
      </div>
      <div class="col-md-6 offset-md-6 col-sm-12">
        <form action="" method="post">
          <input required type="hidden" name="{{csrf.keys.name}}" value="{{csrf.name}}">
          <input required type="hidden" name="{{csrf.keys.value}}" value="{{csrf.value}}">
          <div class="form-group">
            {% if flash.getMessage('error') %}
            <div class="alert alert-danger text-center">
              {% for error in flash.getMessage('error') %}
              {{ error }}
              {% endfor %}
            </div>
            {% endif %}
          </div>
          <div class="form-group">
            <label for="id_username" class="text-white font-weight-bold h5">Usuario</label>
            <input required type="text" class="form-control" id="id_username" name="username" autofocus autocomplete="off">
          </div>
          <div class="form-group mb-4">
            <label for="id_password" class="text-white font-weight-bold h5">Contraseña</label>
            <input required type="password" class="form-control" id="id_password" name="password" autocomplete="off">
          </div>
          <p class="text-center text-white col-sm-12">RECUERDA QUE TU USUARIO ES EL NUMERO DE GESTOR ASIGNADO <b style="color: red;">(EN CASO GESTOR)</b></p>
          <button type="button"  id="btn_modal" class="btn btn-danger mb-5" data-toggle="modal" data-target="#modaluser">
            REGISTRATE
          </button>
          <button type="submit" class="btn btn-primary mb-5">INGRESAR</button>
          
        </form>
      </div>
    </div>
  </div>
</div>


<!-- Modal PARA REGISTRAR USUARIO-->
<form method="POST" action="{{path_for('getor_new_post')}}">
  <div class="modal fade" id="modaluser" tabindex="-1" role="dialog" aria-labelledby="modalregistro" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title m-auto" id="modalregistro">NUEVO REGISTRO DE USUARIO (GESTOR)</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">

          <div class="container">

            <input type="hidden" name="{{csrf.keys.name}}" value="{{csrf.name}}">
            <input type="hidden" name="{{csrf.keys.value}}" value="{{csrf.value}}">
            <div class="form-group row">
              <label for="nombre" class="col-sm-4 form-control-label">Código de Gestor</label>
              <div class="col-sm-8">
                <input value="{{ session.signup.codigo }}" class="form-control" id="codigo" placeholder="Inserta tu código de usuario" type="text"
                  name="codigo" required="" title="Campo requerido">
              </div>
            </div>
            <div class="form-group row">
              <label for="identificacion" class="col-sm-4 form-control-label">Identificación</label>
              <div class="col-sm-8">
                <input value="{{ session.signup.identificacion }}"  required class="form-control" id="identificacion" placeholder="Identificación" type="text"
                  name="identificacion">
              </div>
            </div>
            <div class="form-group row">
              <label for="nombre" class="col-sm-4 form-control-label">Nombre</label>
              <div class="col-sm-8">
                <input value="{{ session.signup.nombre_gestor }}" required class="form-control" id="nombre_deudor" placeholder="Inserta tu código de usuario" type="text"
                  name="nombre_gestor">
              </div>
            </div>
            <div class="form-group row">
              <label for="asunto" class="col-sm-4 form-control-label">Apellido</label>
              <div class="col-sm-8">
                <input value="{{ session.signup.apellido_gestor }}" required class="form-control" id="apellido" placeholder="Apellido" type="text" name="apellido_gestor">
              </div>
            </div>
            <h4 class="alert alert-primary text-center">Datos de Usuario</h4>

            <div class="form-group row">
              <label for="nombre" class="col-sm-4 form-control-label">Contraseña</label>
              <div class="col-sm-8">
                <input required class="form-control" id="claveprueba" placeholder="Ingrese Contraseña" type="password"
                  name="pass1" onblur="validaregistrop()">
              </div>

            </div>
            <div class="form-group row">
              <label for="nombre" class="col-sm-4 form-control-label">Repetir Contraseña</label>
              <div class="col-sm-8">
                <input required class="form-control" id="claveconfirmada" placeholder="Repita la Contraseña" type="password"
                  name="pass2" onblur="validaregistrop()">
              </div>
            </div>
            {% if flash.getMessage('error1') %}
            <div class="alert alert-danger text-center">
              {% for error in flash.getMessage('error1') %}
              {{ error }}
              {% endfor %}
            </div>
            {{ session|unset('acreedor') }}
            {% endif %}

            <h5 class=" text-center"><b style="color: red;">(*)</b>Recuerda que tu código de gestor sera tu nuevo usuario</h5>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">ATRAS</button>
          <button type="submit" class="btn btn-primary" id="btnregistrarp">REGISTRAR</button>
        </div>
      </div>
    </div>
  </div>
</form>
<script type="text/javascript">

  // function validaregistrop() {

  //   var pass1 = document.getElementById('claveprueba').value;
  //   var pass2 = document.getElementById('claveconfirmada').value;


  //   if (pass1 == null || pass1.length == 0 || /^\s+$/.test(pass1)) {
  //     $("#claveprueba").parent().parent().attr("class", "form-group has-error");
  //     $("#claveprueba").parent().children("span").text("Campo Vacio").show();
  //     return false;
  //   } else if (pass2 == null || pass2.length == 0 || /^\s+$/.test(pass2)) {
  //     $("#claveconfirmada").parent().parent().attr("class", "form-group has-error");
  //     $("#claveconfirmada").parent().children("span").text("Campo Vacio").show();
  //     return false;
  //   } else if (pass1.length < 8) {
  //     $("#claveconfirmada").parent().children("span").text("Clave muy corta debe tener al menos 8 caracteres").show();
  //     return false;

  //   } else if (!(pass1 == pass2)) {
  //     $("#claveconfirmada").parent().children("span").text("Error Claves no coinciden").show();
  //     return false;
  //   } else {
  //     $("#claveprueba").parent().parent().attr("class", "form-group has-success");
  //     $("#claveprueba").parent().children("span").text("").hide();

  //   }
  // }

</script>
{% endblock %}

{% block js %}
{% if flash.getMessage('error1') %}
<script>
    $('#btn_modal').click()
</script>
{% endif %}
{% endblock %}
